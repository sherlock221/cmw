var imgList=["resources/bg-default.jpg","resources/big-circle-01.png","resources/big-circle-02.png","resources/font.png","resources/fruit.png","resources/people.png","resources/light.png","resources/head.png","resources/main-img.png","resources/main-img-02.png","resources/svg/baishi.svg","resources/svg/circle-org.svg","resources/svg/earth.svg","resources/svg/weilai.svg","resources/svg/xiangxiang.svg","resources/seq.png","resources/line/L1.png","resources/line/L2.png","resources/line/L3.png","resources/line/L4.png","resources/line/L5.png","resources/line/L6.png","resources/line/R1.png","resources/line/R3.png","resources/line/R4.png","resources/line/R5.png"];new loadermsk(imgList,"#0e79ef",function(){console.log("加载完成...");Event.init()});var resultMsgArray=["我在全通·习悦的年薪Hold的住DS，再去4次帕劳，快来看看你的！","我在全通·习悦的年薪Hold的住卡宴，再去5次塞班，快来看看你的！","我在全通·习悦的年薪Hold的住特斯拉，再去6次马尔代夫，快来看看你的！"];var answerList=[];var Indicator=0;var jj=0;var tb=["A","B","C","D"];var UI={AnswerLayer:$("#answerLayer"),FirstLayer:$("#indexLayer"),SecondLayer:$("#secondLayer"),ThirdLayer:$("#thirdLayer"),FourLayer:$("#fourLayer"),FiveLayer:$("#fiveLayer"),SixLayer:$("#sixLayer"),SevenLayer:$("#sevenLayer"),SubAnswer:$("#subAnswer"),FruitBg:$("#fruitBg"),BOX_LAYER:$("#seq-layer"),ShareLayer:$("#shareLayer"),AnswerBottom:$("#answer-bottom"),AudioEffect:document.getElementById("audioEffect"),AudioEffectBg:document.getElementById("audioEffectBg")};var browser={versions:function(){var u=navigator.userAgent,app=navigator.appVersion;return{trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&u.indexOf("KHTML")==-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1||u.indexOf("Mac")>-1,iPad:u.indexOf("iPad")>-1,webApp:u.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};var isIOS=false;var Event={init:function(){isIOS=browser.versions.ios;this.data();UI.AnswerLayer.on("tap",".answer-select li",function(){var $this=$(this);var answer=$this.attr("data-option");$this.addClass("active").siblings().removeClass("active");if(answer==tb[Indicator]){jj++}setTimeout(function(){nextAnswer(Indicator);if(Indicator==3){UI.AnswerBottom.find(".answer-bottom-layer").hide();UI.SubAnswer.show()}},500)});UI.SubAnswer.bind("tap",function(){UI.AudioEffect.play();UI.AnswerLayer.addClass("out");setTimeout(function(){UI.AnswerLayer.addClass("hide");UI.ShareLayer.removeClass("hide")},500)});UI.AnswerLayer[0].addEventListener("webkitAnimationStart",function(t){console.log(t.animationName);if(t.animationName=="zoomOut"){console.log("end answer");setTimeout(function(){Event.shareAni()},500)}},false);Event.firstAni();Event.secondAni();Event.thirdAni();Event.fourAni();Event.fiveAni();Event.sixAni();Event.sevenAni();var title=randomMsg();getSignature(title);UI.FirstLayer.removeClass("hide")},data:function(){loadAnswerList()},firstAni:function(){if(isIOS){new Vivus("index-xx-svg",{type:"oneByOne",duration:100,file:"resources/svg/xiangxiang.svg"},function(res){console.log(res)})}var $fontEdu=$("#font-education");var $fingerprint=$("#fingerprint");$fontEdu[0].addEventListener("webkitAnimationEnd",function(t){$fingerprint.removeClass("hide")},false);$fingerprint.bind("tap",function(e){UI.AudioEffect.play();UI.AudioEffectBg.pause();UI.FirstLayer.removeClass("out").addClass("out");setTimeout(function(){UI.FirstLayer.addClass("hide");UI.SecondLayer.removeClass("hide")},500)})},secondAni:function(){var $bigringOut=UI.SecondLayer.find(".big-ring-out");$bigringOut[0].addEventListener("webkitAnimationStart",function(t){console.log("end...");if(t.animationName=="zoomOut"){setTimeout(function(){UI.ThirdLayer.removeClass("hide");UI.SecondLayer.addClass("hide")},500)}},false)},thirdAni:function(){var $pointPuzzy=UI.ThirdLayer.find(".point-01");var $puzzyWrap=UI.ThirdLayer.find(".puzzle-wrap");var $py=UI.ThirdLayer.find("#py");$py[0].addEventListener("webkitTransitionEnd",function(t){UI.ThirdLayer.addClass("out");UI.AudioEffect.play();setTimeout(function(){UI.ThirdLayer.addClass("hide");UI.FourLayer.removeClass("hide")},800)},false);var isEndDrag=false;interact(".draggable").draggable({inertia:true,restrict:{endOnly:true,elementRect:{top:0,left:0,bottom:1,right:1}},onstart:function(){console.log("start");$pointPuzzy.addClass("hide")},onmove:dragMoveListener,onend:function(event){var target=event.target;console.log(isEndDrag,target);target.style.transition=target.style.webkitTransition="transform ease 1s";target.style.transition=target.style.webkitTransition="-webkit-transform ease 1s";target.style.webkitTransform=target.style.transform="rotate(14deg) translate(-76px,193px)"}});function dragMoveListener(event){var target=event.target,x=(parseFloat(target.getAttribute("data-x"))||0)+event.dx,y=(parseFloat(target.getAttribute("data-y"))||0)+event.dy;console.log(x,y);
    if(x<-130&&y>135){isEndDrag=true;return}if(!isEndDrag){target.style.webkitTransform=target.style.transform="translate("+x+"px, "+y+"px)";target.setAttribute("data-x",x);target.setAttribute("data-y",y)}}},fourAni:function(){var $point=UI.FourLayer.find(".point-01");new Vivus("third-earth-svg",{type:"oneByOne",duration:100,file:"resources/svg/earth.svg"},function(res){new Vivus("third-main-svg",{type:"delayed",duration:100,file:"resources/svg/baishi.svg"},function(res){end()})});var end=function(){};$point.bind("tap",function(){console.log("tao..");UI.AudioEffect.play();UI.FourLayer.addClass("out");setTimeout(function(){UI.FourLayer.addClass("hide");UI.FiveLayer.removeClass("hide")},500)})},fiveAni:function(){var $point=UI.FiveLayer.find(".point-01");var $puzzyWrap=UI.FiveLayer.find(".wg-cmp-img");$puzzyWrap[0].addEventListener("webkitAnimationEnd",function(t){console.log("five..");$point.removeClass("hide")},false);$point.bind("tap",function(){UI.AudioEffect.play();UI.FiveLayer.addClass("out");setTimeout(function(){UI.SixLayer.removeClass("hide");UI.FiveLayer.addClass("hide")},500)})},sixAni:function(){var sixNext=UI.SixLayer.find("#sixNext");sixNext.bind("tap",function(){UI.AudioEffect.play();UI.SixLayer.addClass("out");setTimeout(function(){UI.SixLayer.addClass("hide");UI.SevenLayer.removeClass("hide")},500)})},sevenAni:function(){var lightBtn=UI.SevenLayer.find("#light-button");lightBtn.bind("tap",function(){UI.AudioEffect.play();UI.SevenLayer.addClass("out");setTimeout(function(){UI.AnswerLayer.removeClass("hide");UI.SevenLayer.addClass("hide")},500)})},shareAni:function(){var $box=UI.BOX_LAYER;var boxTransform=["rotateX(-90deg)","rotateY(-90deg)","rotateX(90deg)","rotateY(90deg)"];var boxIndex=0;var ani=function(){if(boxIndex>boxTransform.length){console.log("完成。。。");clearInterval(boxTimer)}$box[0].style.webkitTransform=boxTransform[boxIndex];$box[0].style.transform=boxTransform[boxIndex];boxIndex++};var boxTimer=setInterval(ani,2000)}};var refreshAnswer=function(obj){UI.AnswerLayer.find(".answer-num").html(obj.questionTitle);UI.AnswerLayer.find(".answer-title").html(obj.questionDesc);var $select=UI.AnswerLayer.find(".answer-select");var temp="";for(var i=0;i<obj.questionOptions.length;i++){var s=obj.questionOptions[i];var li='<li class="" data-option="'+s.optionName+'">  <i class="ib select-active main-img"></i>';li+='<a href="javascript:void(0)">';li+="<span>"+s.optionName+"</span>";li+=s.optionValue;li+="</a></li>";temp+=li}$select.html(temp)};var loadAnswerList=function(){$.getJSON("./data/question.json",function(json){console.log("加载完问题列表...");answerList=json;refreshAnswer(answerList[Indicator])})};var nextAnswer=function(){if(Indicator++>2){console.log(jj);return}var img=UI.AnswerBottom.find("[data='"+Indicator+"']");img.removeClass("hide").siblings().addClass("hide");console.log(img);refreshAnswer(answerList[Indicator])};var randomMsg=function(){return resultMsgArray[Math.floor(Math.random()*3)]};function getSignature(title,desc){var shareUrl=window.location.href;desc=desc||"";$.post("http://imzhiliao.com:3000/wx/signature",{url:location.href.split("#")[0],c_no:"cicada"},function(res){if(res.errcode){alert(res.errcode)}else{wx.config({debug:false,appId:res.appid,timestamp:res.timestamp,nonceStr:res.nonceStr,signature:res.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem"]});wx.ready(function(){var link=shareUrl||window.location.href;var shareData={"desc":"","title":title,link:desc,imgUrl:"http://cicadafile.qiniudn.com/1437448622422U0zVbGsA5T.png"};wx.onMenuShareAppMessage(shareData);wx.onMenuShareTimeline(shareData);wx.onMenuShareQQ(shareData);wx.onMenuShareWeibo(shareData)});wx.error(function(res){alert(res.errMsg)})}})};